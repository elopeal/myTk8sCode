---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    app: docker-private-registry
  name: docker-private-registry-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: docker-private-registry
  template:
    metadata:
      labels:
        app: docker-private-registry
    spec:
      containers:
      - image: registry:2
        imagePullPolicy: IfNotPresent
        name: docker-private-registry
        env:
        - name: REGISTRY_HTTP_ADDR
          value: 0.0.0.0:5000
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/cert.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/cert.key
        ports:
        - containerPort: 5000
          protocol: TCP
        volumeMounts:
        - mountPath: /var/lib/registry
          name: image-store
        - mountPath: /certs
          name: certs
      volumes:
      - emptyDir: {} # THIS IS NOT PERSISTENT! WILL DELETE WITH POD!
        name: image-store
      - name: certs
        secret:
          secretName: registry-tls
          items:
          - key: tls.crt
            path: cert.crt
            mode: 256 # 0400 in decimal
          - key: tls.key
            path: cert.key
            mode: 256 # 0400 in decimal
---
apiVersion: v1
kind: Service
metadata:
  labels:
    service: docker-private-registry
  name: docker-private-registry
spec:
  ports:
  - nodePort: 30500
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: docker-private-registry
  type: NodePort

---
apiVersion: v1
kind: Secret
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVERENDQXZTZ0F3SUJBZ0lVRmE1WldiVGg0R3hxakc5NzgxMi8wVzVDdm1Rd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2NERUxNQWtHQTFVRUJoTUNWVk14RlRBVEJnTlZCQWdUREZCbGJtNXplV3gyWVc1cFlURVRNQkVHQTFVRQpCeE1LU0dGeWNtbHpZblZ5WnpFVE1CRUdBMVVFQ2hNS1MzVmlaWEp1WlhSbGN6RUxNQWtHQTFVRUN4TUNRMEV4CkV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdIaGNOTWpBd01USXdNVGsxT0RBd1doY05NakV3TVRFNU1UazEKT0RBd1dqQnhNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ0JNTVVHVnVibk41YkhaaGJtbGhNUk13RVFZRApWUVFIRXdwSVlYSnlhWE5pZFhKbk1STXdFUVlEVlFRS0V3cExkV0psY201bGRHVnpNU0V3SHdZRFZRUUxFeGhMCmRXSmxjbTVsZEdWeklGUm9aU0JCYkhSaE15QlhZWGt3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXcKZ2dFS0FvSUJBUURmWlVHRHo5dXZGS2ZJYjFaVXF6MWw2ZkhxN1htYjBmZ0ljWUhVVjV5YXllc1MyWTJsVnB6dgpxOTRIdlQ2a3FUMmlKN05yWTB5cmxna3pzMlNTK3FjUlk2eVcrUWJNRDFYN3l1RWxOTGU5d25OZ1djVmhuQjZpCnNQK09Lc204L2RCa3JNbDl3L0RUdGZqUHBSdlc3TDRKT01XWlY2anV0dzJEQkVnV1ducFdQUE8wNXlYWmJHYzgKL1pmS093ZUVZV0tFYS8yL05VKzZpU05uTHZLb1VndXlUTmJNdXgvQmJQZDR3cWZMSk9sOFlLWW1namE5S1h3VgpqRWxUTm9mYkFQSVhkUzlOMUVqbThkVEhuNFl0ekJQVFZxMExpclN3QUhoaDBMbytySFp0WnQra0RpdCthWWczCkZVR1F5d0VheFVMcUVZcGowSW91dEZ1ODJFTzlsaW5WQWdNQkFBR2pnWnd3Z1prd0RnWURWUjBQQVFIL0JBUUQKQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFNQmdOVkhSTUJBZjhFQWpBQQpNQjBHQTFVZERnUVdCQlJDRkwxRzYxOGVuak01OVl4VldQQ1JXb2VVYmpBZkJnTlZIU01FR0RBV2dCU0VuRERqCktHekVvSVNmK2xnM1VzMkY5aGpWVERBYUJnTlZIUkVFRXpBUmdnbHNiMk5oYkdodmMzU0hCSDhBQUFFd0RRWUoKS29aSWh2Y05BUUVMQlFBRGdnRUJBSWpIQURmQnNQNTM4d1g5eTNPTDVkWC82bGZtWEpQeWRFdFFvOUIreXM0UgpLOXFlb2JCcnhud2JXTFVvL1ZDT0tlY3FYcEk4MHFyWkpIZUNKY2U5WjdxaTFib0pid1ZJNmU3elZyTXpxY0JKCkZGOStPamRuMDZLd2hzaXZraXdmeW9zNjlxdVlnZmZxK0FmaDI3SzRKdnVQc3RxK3h4VW85ak1Tb2MrNG4vUGEKQVlidTVZaFA5Um5ZQ0diQ1ZTZzZOZGw5T2lBM1Joakt4N3hXYStsQ1I2S2hwdXphaGxxZVpXT0hFcm0vMjcxNQpUNVRmQStrUGd1dFM2azI1RnlUcWp6cTRtY0lIQnQ5Vi9qcDNzQmNwRE00SnRlUHp1RjJEWWtUZFdSQStkRGE0CnZUV1pwSGNiQzB1WFNJM3pDcEpPK2oxODFUTktiMDV5d3dnMWZwbzBoRDA9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K 
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMzJWQmc4L2JyeFNueUc5V1ZLczlaZW54NnUxNW05SDRDSEdCMUZlY21zbnJFdG1OCnBWYWM3NnZlQjcwK3BLazlvaWV6YTJOTXE1WUpNN05ra3ZxbkVXT3NsdmtHekE5Vis4cmhKVFMzdmNKellGbkYKWVp3ZW9yRC9qaXJKdlAzUVpLekpmY1B3MDdYNHo2VWIxdXkrQ1RqRm1WZW83cmNOZ3dSSUZscDZWanp6dE9jbAoyV3huUFAyWHlqc0hoR0ZpaEd2OXZ6VlB1b2tqWnk3eXFGSUxza3pXekxzZndXejNlTUtueXlUcGZHQ21Kb0kyCnZTbDhGWXhKVXphSDJ3RHlGM1V2VGRSSTV2SFV4NStHTGN3VDAxYXRDNHEwc0FCNFlkQzZQcXgyYldiZnBBNHIKZm1tSU54VkJrTXNCR3NWQzZoR0tZOUNLTHJSYnZOaER2WllwMVFJREFRQUJBb0lCQVFDby8rWUhQTGs2QTB0Rwo0NHVROUJhM3dicmsraEJVcEF5YS9wdTBNeTlqSGp2Ni82QWJvNkdINHlKT0FvbWdjZlFSZHkxUm9VYUFURG5iCjVldkJFV1JRVUhKaHFEVFBMUTdrTkVBTk1JdU1QODJlNTJyZUJBaGRGYi9QSW1tSjB3M1RDN0JHdDNPNkJlRWIKM1JGcGo2SFlRaDJpZXVGdTdnYUh4alp1eXJYZ0JFUHVKcDByOVFqSmxaTDRKTVRndmd4b3ZLcEhtV0pST0tSWgpYOTFXaHExdVkrUUx4eGRJNm14N1lvc2tCVStaZjk3NDNsZWFPRjBZdEN5SXhPS1h5VnlEUXJ4cnFyTU5EVUNTCnF1SXNzaCs0QXNhNDliTkh2NDBqa01PVTNNNnMxZ1JlWDlTcWdtR1ZRWHFRVDFrdU9hZC8zNlg4VURQbWJaQ24KTmtkcjh4RWhBb0dCQU9FS0hJWWRoVjJsZ2h2YkNwM0YxdHo4TzZQUUJjM2pXb2U0L21MNjJnRnF1dGpFSlJ6VwpEUW5GTmZzVGdOb1RXUnMyQnZCb3VOcXROMk9KRStZK0Y1bjR1SHU1dkJxcTRlMFBCQ3U1MmRpSG1aYlJPTmkxCnE0Zjg4ZTVxNWNkNHlpb2tEN2ZjOUxPYVFtNmdwS20wZWNSTW52UDArazJEWGIzbVprUWY1VzV0QW9HQkFQNGgKUG5jRENlUnFxcXVXNm1sbFRSWDE4Q3lqa1hWeDhTWkVudzVUU2VqdHB0OEVxOTQ2VE1wbVVHaTJJWHVsNWpYRwpPM3VTblJJbTFqSHJrUTQzME9kb2t0UEw1K1g5RU85RDc0eS9ValA1TFYrSHBxWENVR2xIM2hmY2dyMVh3ZlVPCklNQ2did3F5WEMyMU90UGFGakxYN0ZmWGJBOHZwbWhITUs2eXJXZ0pBb0dBT09lUnB1ZzRIU0lJOEhwSENQWksKQ3I5TlpYTG94Tk5FeFNVbVRta1lUMXRwdS81OVUvbGNlcWYvcW1tWUg0emM3MkNPQ0tTeWVibHJWQ1FKZ0NNYgpYTGZrRG9VODU1Rm1aOGR3U281SVk5U0dKZmpwNHdLdFNVblE4M1RjZmNBeGZzNTNtd3FvWmZJUDhtRjB3ZVQ5CkZZSTZmMzNtL1VyR25ZcHhPYkRIRjFFQ2dZRUF1eDYvWCtKYzVsT2tWN1JINWxNdzczcW4zamFTWkdnQnFLdmUKY2kzaHZpRS9QZmV5bFc5WUc3QTZoTitXeC9UZ0RiaHBGQlJnazMwRk9yeTVrajZIRTkxc1A0ZGt1WFFkaEJBQgoweUVNNWpnVHNNT3hjVndpMldLUnBnQTRSRExhSGhiSkJ3MGF0a1dlbWdsWHg2Wk5zaUpMWkdLNnJuUG5rK0RYCmQ4c1k1QUVDZ1lCUEk0VTBNRHRCSFpYdXpaOHRKNDlzTDMrQThJSkdJRDQ3N2N1SHhWUEhURjYvVWlEcC9rZk0KUG03YktLam1COUs2c24vV3dQaTZia0E0VXFqNTNnVElBUzl1NTJQMDBVb1phQjd0eWJnWUoyeUxwMVMvekFQYgpVcGk3bE5EQ1R5bzhLOHIyWk1uNDJ5bW5XeTIwMlZHSlhMWTNOa2RHdVpXdzJVYnVTNFdRdmc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
metadata:
  name: registry-tls
  namespace: default
type: Opaque

